; ========================
; 🚀 Clash 终极优化版 (blackmatrix7源)
; 设计原则：极简匹配 | 智能分流 | 动态更新
; 更新时间：2023-10-21
; ========================

; ########################
; 🔄 动态规则提供者（自动更新）
; ########################
rule-providers:
  # 拦截类规则
  adblock:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Advertising/Advertising.yaml"
    path: ./rules/adblock.yaml
    interval: 86400  # 24小时更新

  # 国内规则
  china:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/China/China.yaml"
    path: ./rules/china.yaml
    interval: 86400

; ########################
; 🚦 核心规则（按匹配优先级排序）
; ########################
rules:
  # 1. 强制拦截规则（最高优先级）
  - RULE-SET,adblock,🛑 全球拦截
  - DOMAIN,analytics.google.com,🛑 全球拦截  # 补充常见跟踪域名
  - DOMAIN-KEYWORD,adservice,🛑 全球拦截

  # 2. 国内直连
  - RULE-SET,china,🎯 全球直连
  - GEOIP,CN,🎯 全球直连,no-resolve
  - GEOSITE,CN,🎯 全球直连
  - GEOSITE,private,🎯 全球直连  # 本地网络
  - DOMAIN-SUFFIX,cn,🎯 全球直连  # 兜底CN域名

  # 3. 常用国外服务分流
  - GEOSITE,google,🚀 出国代理
  - GEOSITE,github,🚀 出国代理
  - GEOSITE,netflix,🚀 出国代理
  - GEOSITE,openai,🚀 出国代理  # AI服务专用分流
  - GEOSITE,geolocation-!cn,🚀 出国代理  # 非中国地区域名

  # 4. 游戏平台特殊处理
  - DOMAIN-KEYWORD,steam,🚀 出国代理
  - DOMAIN-SUFFIX,epicgames.com,🚀 出国代理
  - IP-CIDR,192.0.73.0/24,🚀 出国代理  # PlayStation网络

  # 5. 最终兜底规则
  - MATCH,🐟 漏网之鱼

; ########################
; ⚡ 策略组智能优化
; ########################
proxy-groups:
  - name: "🚀 出国代理"
    type: select
    proxies:
      - ♻️ 自动选择
      - DIRECT  # 直连备选

  - name: "♻️ 自动选择"
    type: url-test
    url: "http://www.gstatic.com/generate_204"
    interval: 300  # 10分钟测速
    tolerance: 50  # 延迟容差(ms)
    proxies: $proxy-providers.proxy_auto  # 引用代理提供商

  - name: "🎯 全球直连"
    type: select
    proxies:
      - DIRECT

  - name: "🛑 全球拦截"
    type: select
    proxies:
      - REJECT
      - DIRECT  # 调试用备选

  - name: "🐟 漏网之鱼"
    type: select
    proxies:
      - 🚀 出国代理
      - 🎯 全球直连

; ########################
; 🛠️ 高级引擎配置
; ########################
dns:
  enable: true
  enhanced-mode: fake-ip
  nameserver:
    - 223.5.5.5  # 阿里DNS
    - 119.29.29.29  # 腾讯DNS
  fallback:
    - tls://8.8.4.4:853  # 加密DNS

tun:
  enable: true
  stack: system
  auto-route: true

experimental:
  ignore-resolve-fail: true  # 跳过解析失败域名
